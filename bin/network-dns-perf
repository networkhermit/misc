#!/bin/bash

while (( $# > 0 )); do
    case "${1}" in
        -c|--count)
            if [ -z "${2}" ]; then
                echo "✗ option takes an argument: ‘${1}’" 1>&2
                exit 1
            fi
            COUNT=${2}
            shift 2
            ;;
        --)
            shift
            break
            ;;
        *)
            break
            ;;
    esac
done

if (( $# > 0 )); then
    echo "✗ unrecognized parameter: ‘${1}’" 1>&2
    exit 1
fi

COUNT=${COUNT:=64}

NAMESERVER=$(awk '/nameserver/ { print $2 }' /etc/resolv.conf)

for i in ${NAMESERVER}; do
    fping --count "${COUNT}" --quiet "${i}"
done
